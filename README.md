# Обработка загрузки дисконтных карт из Excel

## Описание

Обработка предназначена для массовой загрузки данных дисконтных карт из Excel файла в справочник 1С с автоматическим созданием контрагентов и видов карт.

## Функциональность

- Загрузка данных из Excel файла (.xlsx, .xls)
- Поддержка колонок: НомерКарты, Телефон, ФИОВладельца, Штрихкод, ВидСкидки
- Автоматическое создание контрагентов при отсутствии
- Автоматическое создание видов дисконтных карт
- Создание новых записей или обновление существующих по штрихкоду
- Валидация данных и обработка ошибок
- Статистика загрузки

## Установка

1. Скопируйте файл `ОбработкаЗагрузкаДисконтныхКарт.epf` в папку с обработками
2. Откройте обработку в 1С:Предприятие
3. Убедитесь, что в конфигурации есть справочники:
   - ДисконтныеКарты
   - Контрагенты
   - ВидыДисконтныхКарт

## Использование

### Подготовка Excel файла

1. Создайте Excel файл с заголовками в первой строке:
   ```
   НомерКарты | Телефон | ФИОВладельца | Штрихкод | ВидСкидки
   ```

2. Заполните данные начиная со второй строки

### Загрузка данных

1. Откройте обработку "Загрузка дисконтных карт из Excel"
2. Нажмите кнопку "Выбрать файл" и выберите Excel файл
3. Нажмите кнопку "Загрузить данные"
4. Дождитесь завершения обработки
5. Проверьте статистику загрузки

## Структура справочников

### Справочник "Дисконтные карты":
- **Наименование** (Строка) - номер/название карты
- **КодКартыШтрихкод** (Строка) - штрихкод карты
- **ВладелецКарты** (СправочникСсылка.Контрагенты) - ссылка на контрагента
- **ВидДисконтнойКарты** (СправочникСсылка.ВидыДисконтныхКарт) - ссылка на вид карты

### Справочник "Контрагенты":
- **Наименование** (Строка) - ФИО владельца
- **Телефон** (Строка) - номер телефона

### Справочник "ВидыДисконтныхКарт":
- **Наименование** (Строка) - название вида скидки

## Логика работы

1. **Обработка контрагента**:
   - Поиск по ФИО в справочнике Контрагенты
   - Создание нового контрагента с ФИО и телефоном при отсутствии

2. **Обработка вида карты**:
   - Поиск по наименованию в справочнике ВидыДисконтныхКарт
   - Создание нового вида при отсутствии

3. **Создание карты**:
   - Поиск карты по штрихкоду
   - Создание новой или обновление существующей

## Требования

- 1С:Предприятие 8.3
- Microsoft Excel (для работы COM объектов)
- Права на создание COM объектов
- Справочники: ДисконтныеКарты, Контрагенты, ВидыДисконтныхКарт
- Права на создание записей в справочниках

## Возможные ошибки

1. **"Файл не найден"** - проверьте путь к файлу
2. **"COM объект не создан"** - убедитесь, что Excel установлен
3. **"Справочник не найден"** - проверьте наличие справочников в конфигурации
4. **"Нет прав доступа"** - проверьте права пользователя
5. **"Ошибка создания контрагента"** - проверьте права на создание записей в справочнике Контрагенты

## Поддержка

При возникновении проблем:
1. Проверьте формат Excel файла
2. Убедитесь в корректности данных
3. Проверьте права доступа к справочникам
4. Обратитесь к администратору системы

## Версии

- v2.0 - Обновленная версия с поддержкой связанных справочников
- v1.0 - Базовая версия с поддержкой основных колонок
- Планируется: валидация телефонов, логирование, поддержка дополнительных колонок 